---
title: DNS介绍
tags: 
  - DNS
categories: 
  - 浏览器
date: 2023-08-01
summary: DNS介绍
description: DNS介绍
---

### 什么是DNS

**域名系统** (DNS - Domain Name System) 是 Internet 电话簿。人们通过例如 `baidu.com` 或 `qq.com` 等域名在线访问信息。Web 浏览器通过 Internet 协议 (IP) 地址进行交互。DNS 将域名转换为 IP 地址，以便浏览器能够加载 Internet 资源。



连接到 Internet 的每个设备都有一个唯一 IP 地址，其他计算机可使用该 IP 地址查找此设备。DNS 服务器使人们无需存储例如 `192.168.1.1`（IPv4 中）等 IP 地址或更复杂的较新字母数字 IP 地址，例如 `2400:cb00:2048:1::c629:d7a2`（IPv6 中）。



### DNS如何工作

DNS 解析过程涉及将主机名（例如 `www.example.com`）转换为计算机友好的 IP 地址（例如 `192.168.1.1`）。Internet 上的每个设备都被分配了一个 IP 地址，必须有该地址才能找到相应的 Internet 设备 - 就像使用街道地址来查找特定住所一样。当用户想要加载网页时，用户在 Web 浏览器中键入的内容（`example.com`）与查找 `example.com` 网页所需的机器友好地址之间必须进行转换。



### DNS服务器类别

::: Tip

所有 DNS 服务器都属于以下四个类别之一：递归解析器、根域名服务器、TLD 域名服务器和权威性域名服务器。在典型 DNS 查找中（当没有正在进行的高速缓存时），这四个 DNS 服务器协同工作来完成将指定域的 IP 地址提供给客户端的任务（客户端通常是一个存根解析器 - 内置于操作系统的简单解析器）。

:::



- **[DNS 解析器（DNS recursor）]()** - 该解析器可被视为被要求去图书馆的某个地方查找特定图书的图书馆员。DNS 解析器是一种服务器，旨在通过 Web 浏览器等应用程序接收客户端计算机的查询。然后，解析器一般负责发出其他请求，以便满足客户端的 DNS 查询。
- **[根域名服务器（Root nameserver）]()** - 根域名服务器是将人类可读的主机名转换（解析）为 IP 地址的第一步。可将其视为指向不同书架的图书馆中的索引 - 一般其作为对其他更具体位置的引用。
- **[TLD 域名服务器（TLD nameserver）]()** - 顶级域服务器（TLD）可被视为图书馆中的特定书架。此域名服务器是搜索特定 IP 地址的下一步，其托管主机名的最后一部分（在 `example.com` 中，TLD 服务器为 「com」）。
- **[权威性域名服务器（Authoritative nameserver ）]()** - 可将这个最终域名服务器视为书架上的字典，其中特定名称可被转换成其定义。权威性域名服务器是域名服务器查询中的最后一站。如果权威性域名服务器能够访问请求的记录，则其会将已请求主机名的 IP 地址返回到发出初始请求的 DNS 解析器（图书管理员）。



### DNS查找IP地址步骤

::: Tip 注意

通常，DNS 查找信息将本地缓存在查询计算机内，或者远程缓存在 DNS 基础设施内。DNS 查找通常有 8 个步骤。缓存 DNS 信息时，将从 DNS 查找过程中跳过一些步骤，从而使该过程更快。以下示例概述了不缓存任何内容时的所有 8 个步骤。

:::



>DNS服务器根据域名的层级，进行分级查询。
>
>需要明确的是，每一级域名都有自己的NS（Name Server的缩写）记录，NS记录指向该级域名的域名服务器。



1. 用户在 Web 浏览器中键入 `example.com`，查询传输到 Internet 中，并被 DNS 递归解析器接收。
2. 接着，解析器向 DNS 根域名服务器（.）发起查询请求。
3. 然后，根服务器返回其域信息的顶级域（TLD）DNS 服务器（例如 .com 或 .net）的 NS 记录和 A 记录给该解析器。例如：在访问 `example.com` 时，我们的请求指向 .com TLD 服务器。
4. 然后，解析器向 .com TLD 服务器发出请求。
5. TLD 服务器随后返回域名 `example.com` 的**权威性域名服务器** NS 记录和 A 记录。
6. 最后，递归解析器将查询发送到域的域名服务器。
7. `example.com` 的 IP 地址从**权威性域名服务器**返回到解析器。
8. 然后 DNS 解析器使用最初请求的域的 IP 地址响应 Web 浏览器。

> DNS 查找经过这 8 个步骤返回 `example.com` 的 IP 地址后，浏览器便能发出对该网页的请求。

9. 浏览器向该 IP 地址发出 HTTP 请求。
10. 位于该 IP 的服务器返回将在浏览器中呈现的网页（第 10 步）。



### DNS查询的类型

典型 DNS 查找中会出现三种类型的查询。通过组合使用这些查询，优化的 DNS 解析过程可缩短传输距离。在理想情况下，可以使用缓存的记录数据，从而使 DNS 域名服务器能够返回非递归查询。

1. **递归查询** - 在递归查询中，DNS 客户端要求 DNS 服务器（一般为 DNS 递归解析器）将使用所请求的资源记录响应客户端，或者如果解析器无法找到该记录，则返回错误消息。
2. **迭代查询** - 在这种情况下，DNS 客户端将允许 DNS 服务器返回其能够给出的最佳应答。如果所查询的 DNS 服务器与查询名称不匹配，则其将返回对较低级别域名空间具有权威性的 DNS 服务器的引用。然后，DNS 客户端将对引用地址进行查询。此过程继续使用查询链中的其他 DNS 服务器，直至发生错误或超时为止。
3. **非递归查询** - 当 DNS 解析器客户端查询 DNS 服务器以获取其有权访问的记录时通常会进行此查询，因为其对该记录具有权威性，或者该记录存在于其缓存内。DNS 服务器通常会缓存 DNS 记录，以防止更多带宽消耗和上游服务器上的负载。



### DNS缓存方式

#### DNS高速缓存

缓存的目的是将数据临时存储在某个位置，从而提高数据请求的性能和可靠性。DNS 高速缓存涉及将数据存储在更靠近请求客户端的位置，以便能够更早地解析 DNS 查询，并且能够避免在 DNS 查找链中进一步向下的额外查询，从而缩短加载时间并减少带宽 CPU 消耗。DNS 数据可缓存到各种不同的位置上，每个位置均将存储 DNS 记录并保存由生存时间（TTL）决定的一段时间。



#### 浏览器DNS缓存

现代 Web 浏览器设计为默认将 DNS 记录缓存一段时间。目的很明显；越靠近 Web 浏览器进行 DNS 缓存，为检查缓存并向 IP 地址发出正确请求而必须采取的处理步骤就越少。发出对 DNS 记录的请求时，浏览器缓存是针对所请求的记录而检查的第一个位置。

在 Chrome 浏览器中，您可以转到 `chrome://net-internals/#dns` 查看 DNS 缓存的状态。



#### 操作系统（OS）级DNS缓存

操作系统级 DNS 解析器是 DNS 查询离开您计算机前的第二站，也是本地最后一站。操作系统内旨在处理此查询的过程通常称为「存根解析器」或 「DNS 客户端」。当存根解析器获取来自某个应用程序的请求时，其首先检查自己的缓存，以便查看是否有此记录。如果没有，则将本地网络外部的 DNS 查询（设置了递归标记）发送到 Internet 服务提供商（ISP）内部的 DNS 递归解析器。



### 总结

![DNS运行机制](https://shinoimg.yyshino.top/img/202303291607036.png)



### 参考

```
https://zzz.run/posts/dns-and-how-it-works/
https://howiezhao.github.io/2020/12/29/dns/
```

